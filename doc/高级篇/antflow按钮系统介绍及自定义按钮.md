# AntFlow按钮系统介绍

AntFlow的按钮系统是一个完善的工作流操作按钮管理框架，支持根据流程状态、用户权限和节点配置动态显示不同的操作按钮。

AntFlow的按钮系统采用了配置化和动态化的设计理念，能够根据流程状态、用户权限、节点类型等多个维度智能地决定按钮的显示和隐藏。系统支持丰富的按钮类型，覆盖了工作流场景中的各种操作需求，同时提供了良好的扩展性，可以根据业务需要添加新的按钮类型和操作逻辑。

## 按钮类型体系

AntFlow定义了丰富的按钮类型，包括基本的流程操作按钮如提交、同意、不同意，以及高级功能按钮如转办、加批、退回任意节点等。 详情查看ProcessOperationEnum

## 页面类型分类

按钮系统支持三种主要的页面类型：发起页（initiate）、审批页（audit）和查看页（toView），每种页面类型会显示不同的按钮组合。

## 动态按钮配置

核心的按钮配置逻辑由ConfigFlowButtonContans类实现，它能够根据流程状态动态决定显示哪些按钮。对于审批中的流程，系统会获取配置的按钮并根据用户权限添加监控按钮（如变更处理人、终止）。 [3](#0-2)

对于有监控权限的用户，系统会自动添加变更处理人和终止流程的管理按钮。

## 多人审批支持

系统支持多人审批场景，当检测到当前节点为多人审批节点时，会清空其他按钮并只显示"承办"按钮，实现多人抢办的业务逻辑。

## 流程完成状态处理

对于已完成的流程，系统会过滤掉无效的按钮（如作废按钮），只保留查看类操作，并将这些按钮同步到发起页和审批页显示。

## 按钮数据结构

每个按钮都通过ProcessActionButtonVo类来表示，包含按钮类型、显示方式、颜色类型、按钮名称等属性，支持在PC端和移动端的不同显示需求。

## 按钮操作执行

当用户点击按钮时，ButtonOperationServiceImpl负责执行具体的按钮操作，通过工厂模式获取对应的处理适配器，实现不同按钮操作的业务逻辑处理。 

> 此类是antflow动作执行核心类,流程的很多功能都是通过此服务完成,将入口统一,然后再分发到不同的实现类。保持antflow整体与前端交互的核心接口只有两个。即

**{{serverurl}}/bpmnConf/process/buttonsOperation**和{{serverurl}}/bpmnConf/process/viewBusinessProcess，不用记过多接口。同时也方便用户借鉴现有功能扩展自己的功能实现.

## 自定义按钮

上面介绍过，antflow流程按钮根据按钮所处页面类型不同，整体上分为可编辑页面按钮和只读页面按钮。其中可编辑页面按钮分为发起页按钮和审批页按钮（并不是所有流程都设计的支持审批人可以编辑数据，但是是有这种能力的），只读页按钮又分为发起人查看页（即我的发起页面）、其它审批人查看页（包括我的已办和抄送页面按钮）。

### 扩展步骤

1. 在ButtonTypeEnum定义自己的按钮，里面已经定义了很多，继续往下写即可。
2. 在ConfigFlowButtonSortEnum里定义自己的按钮，枚举值要和ButtonTypeEnum里保持一致，可以参照已有的配置
3. 在ProcessOperationEnum里添加自己定义的按钮，枚举值要和ButtonTypeEnum里定义一致，可参照已有的配置。
4. 实现ProcessOperationAdaptor接口，参数一个已有的实现。实现此接口主要是为了为按钮提供动作功能，没有动作按钮是没有意义的。
5. 在AntFlowButtonsOperationPostProcessor里增加一个case（参照已有的，可以没有任何实现），切记一定要break，不然switch 会向下贯穿。此类为动作事件监听器，主要实现特定动作触发整体监听。
6. 页面里添加相应的按钮配置供用户交互选择，配置都放在了nodes里的条件里的buttons条目里面。审批页按钮放在approvalPage对象里，查看页面按钮放在viewPage里面
